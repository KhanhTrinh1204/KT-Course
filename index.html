<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/dark.css">
    <link rel="stylesheet" href="./css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <title>KT Course - Jarvis AI Assistant</title>
    <style>
        #jarvis-messages::-webkit-scrollbar { width: 5px; }
        #jarvis-messages::-webkit-scrollbar-thumb { background: #003566; border-radius: 10px; }
        .jarvis-window {
            display: none; position: fixed; bottom: 90px; right: 20px; 
            width: 350px; max-width: 90vw; height: 500px; 
            background: white; border-radius: 15px; flex-direction: column; 
            box-shadow: 0 5px 25px rgba(0,0,0,0.2); overflow: hidden; 
            border: 1px solid #ddd; z-index: 1001;
        }
    </style>
</head>

<body>
    <header id="header">
        <nav class="container-1 flex">
            <div class="nav-logo flex"><h4>KAY FRANCIS TEE</h4></div>
            <div class="nav-list">
                <ul class="flex">
                    <li><a class="nav-active">Home</a></li>
                    <li><a>About Me</a></li>
                    <li><a>Contact</a></li>
                </ul>
            </div>
            <div class="subbtn">
                <button><a href="https://www.facebook.com/kaytee1204/" target="_blank">KhanhTrinh1204</a></button>
            </div>
        </nav>
    </header>

    <main id="main">
        <section class="biosec container flex">
            <div class="bio">
                <h4>ÁöÜ„Åï„Çì„ÄÅ„Åì„Çì„Å´„Å°„ÅØ !</h4>
                <h1>Kh√°nh Tr·ªãnh (N2)</h1>
                <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi KT-Course. N∆°i h·ªçc JPD113, JPD123, JPD133 mi·ªÖn ph√≠.</p>
            </div>
            <div class="bioimg">
                <img src="img/nam_preview_rev_1.png" alt="Khanh Trinh">
            </div>
        </section>
        
        <section class="container hottopics flex">
            <div class="topics"><h3>Our Courses</h3></div>
            <div class="hotcards flex">
                <div class="hcard"><a><img src="img/JPD113.jpg"></a></div>
                <div class="hcard"><a><img src="img/JPD123.jpg"></a></div>
                <div class="hcard"><a><img src="img/JPD133.jpg"></a></div>
            </div>
        </section>
    </main>

    <div id="jarvis-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button id="jarvis-toggle" style="background: #003566; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; font-size: 28px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
            ü§ñ
        </button>
        <div id="jarvis-window" class="jarvis-window">
            <div style="background: #003566; color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
                <span><i class="fa-solid fa-robot"></i> Jarvis AI Assistant</span>
                <span id="close-chat" style="cursor: pointer;">&times;</span>
            </div>
            <div id="jarvis-messages" style="flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #f4f7f6;">
                <div style="background: #e1e1e1; padding: 10px; border-radius: 10px 10px 10px 0; align-self: flex-start; font-size: 14px; max-width: 85%;">
                    Ch√†o b·∫°n! M√¨nh l√† Jarvis. B·∫°n c·∫ßn h·ªèi g√¨ v·ªÅ ki·∫øn th·ª©c JPD kh√¥ng?
                </div>
            </div>
            <div style="padding: 10px; border-top: 1px solid #eee; display: flex; background: white; align-items: center;">
                <input type="text" id="jarvis-input" placeholder="H·ªèi Jarvis..." style="flex: 1; border: 1px solid #ddd; padding: 10px; border-radius: 20px; outline: none;">
                <button id="jarvis-send" style="background: #003566; color: white; border: none; width: 35px; height: 35px; margin-left: 8px; border-radius: 50%; cursor: pointer;"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        // KI·ªÇM TRA: API KEY N√ÄY PH·∫¢I TR√ôNG KH·ªöP V·ªöI ·∫¢NH B·∫†N G·ª¨I
        const KEY = "AIzaSyBmA4si4q_hXgBXXfXuUN0s28GQZeAFbgc"; 
        
        // S·ª¨ D·ª§NG V1 THAY V√å V1BETA ƒê·ªÇ ·ªîN ƒê·ªäNH H∆†N
        const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${KEY}`;

        // B·ªò N√ÉO 55 C√ÇU
        const KB = `B·∫°n l√† Jarvis c·ªßa KT-Course. T√°c gi·∫£ Kh√°nh Tr·ªãnh (N2). 1. KT-Course l√† web h·ªçc ti·∫øng Nh·∫≠t mi·ªÖn ph√≠. 2. JPD113 h·ªçc ch·ªØ c√°i. (D√°n ti·∫øp c√¢u c·ªßa b·∫°n ·ªü ƒë√¢y)`;

        const jarvisToggle = document.getElementById('jarvis-toggle');
        const jarvisWindow = document.getElementById('jarvis-window');
        const messagesDiv = document.getElementById('jarvis-messages');
        const jarvisInput = document.getElementById('jarvis-input');

        jarvisToggle.onclick = () => { jarvisWindow.style.display = (jarvisWindow.style.display === 'none' || !jarvisWindow.style.display) ? 'flex' : 'none'; };
        document.getElementById('close-chat').onclick = () => { jarvisWindow.style.display = 'none'; };

        async function handleSend() {
            const prompt = jarvisInput.value.trim();
            if (!prompt) return;
            
            appendMsg(prompt, 'user');
            jarvisInput.value = '';
            const loadingId = appendMsg("Jarvis ƒëang tra c·ª©u...", 'ai');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `${KB}\n\nC√¢u h·ªèi: ${prompt}` }] }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("L·ªói t·ª´ Google API:", errorData);
                    throw new Error(errorData.error.message || "L·ªói m·∫°ng");
                }

                const data = await response.json();
                document.getElementById(loadingId).remove();
                appendMsg(data.candidates[0].content.parts[0].text, 'ai');

            } catch (error) {
                console.error("Chi ti·∫øt l·ªói:", error);
                document.getElementById(loadingId).innerText = "L·ªói k·∫øt n·ªëi r·ªìi b·∫°n ∆°i! Ki·ªÉm tra l·∫°i API Key nh√©.";
            }
        }

        function appendMsg(text, sender) {
            const id = 'msg-' + Date.now();
            const msg = document.createElement('div');
            msg.id = id; msg.innerText = text;
            msg.style.padding = "10px"; msg.style.borderRadius = "10px";
            msg.style.maxWidth = "85%"; msg.style.fontSize = "14px";
            msg.style.alignSelf = sender === 'user' ? "flex-end" : "flex-start";
            msg.style.background = sender === 'user' ? "#003566" : "#fff";
            msg.style.color = sender === 'user' ? "white" : "#333";
            if(sender !== 'user') msg.style.border = "1px solid #ddd";
            messagesDiv.appendChild(msg);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; 
            return id;
        }

        document.getElementById('jarvis-send').onclick = handleSend;
        jarvisInput.onkeypress = (e) => { if (e.key === 'Enter') handleSend(); };
    </script>
</body>
</html>
